name: Code Linter

on: push

jobs:
  resharper-core-lint:
    name: Clean up C# code base via R# CLT
    runs-on: ubuntu-latest
    env:
      working-directory : ${{ secrets.PROJECT_WORKING_DIRECTORY }}

    steps:
      - uses: actions/checkout@v2
      - run: git pull
      - name: Setup .NET Core
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: '5.0.301'
      - name: Setup ReSharper Command Line Tools
        run: dotnet tool install --global JetBrains.ReSharper.GlobalTools --version 2021.1.2
      - name: Clean up codebase via ReSharper Command Line Tools
        run: jb cleanupcode --profile=${{ secrets.RESHARPER_PROFILE_NAME }} --config=${{ secrets.RESHARPER_CONFIG_PATH }} ${{ secrets.MAIN_SOLUTION_NAME }}
        working-directory: ${{ env.PROJECT_WORKING_DIRECTORY }}
      - name: Commit changes
        uses: EndBug/add-and-commit@v5
        with:
          message: "[Bot] Automated ReSharper CLT update"
          add: "*.cs"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}